<html>
<head>
	<title>vuemod</title>
</head>
<body>
	<svg id="app" width="1000" height="600">
		<boxes v-for="item in boxes" v-bind:box="item"></boxes>
		<box :box="{text: 'container', x: 20, y: 250}">
			<box :box="{text: 'child', x: 10, y: 10}"></box>
		</box>
	</svg>
</body>

<script src="https://unpkg.com/vue/dist/vue.js"></script>

<script>
var boxVar = Vue.component('box', {
	props: ['box'],
	template:
		'<g v-on:click="box.text = \'qwe\'" v-adjust_size class="node" :transform="\'translate(\' + box.x + \',\' + box.y + \')\'">\
			<rect height="20" stroke="black" fill="none"/>\
			<text x=".1em" y=".9em">{{ box.text }}</text>\
			<slot></slot>\
		</g>',
	directives: {
		adjust_size: {
			inserted: sizeAroundText,
			componentUpdated: sizeAroundText,
		},
	},
});

Vue.component('boxes', {
	props: ['box'],
	template:
		'<box :box="box">\
			<boxes v-for="item in box.children" v-bind:box="item"></boxes>\
		</box>'
});

Vue.component('dbox', {
	props: ['box'],
	template:
		'<box :box="box"></box>'
});

var app = new Vue({
	el: '#app',
	data: {
		boxes: [
		{text: 'Vegetables', x: 10, y: 10},
		{text: 'Cheese', x: 20, y: 40},
		{text: 'Whatever', x: 30, y: 70},
		{text: 'parent', x: 40, y: 100, children: [
				{text: 'child0', x: 10, y: 10, children: [
						{text: 'child1', x: 10, y: 10},
						{text: 'child2', x: 10, y: 40}
					]
				},
				{text: 'child3', x: 10, y: 80}
			]
		}
	]
	}
});

function changeText () {
	app.boxes[0].text = 'asd';
}

function sizeAroundText(el) {
	console.log('sizeAroundText');
	// size the rect around the text
    var rect = el.children[0];
    var text = el.children[1];
    var bb = text.getBBox();
    rect.setAttribute('width', bb.width + 2 * bb.x);
    rect.setAttribute('height', bb.height);
}
</script>
</html>
